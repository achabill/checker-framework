%\htmlhr
\chapter{Index Checker for array bounds\label{index-checker}}

The Index Checker warns about unsafe array accesses.  It protects
against Java's ArrayIndexOutOfBoundsException. A class checked by the
Index Checker cannot throw an ArrayIndexOutOfBoundException unless the
index has overflowed or underflowed.

To do so, it keeps track of the ranges of values potential indexes may
take on. There are two ways an index can fail to be safe for use as an
array index: either it can be too high or it can be too low. The Index
Checker will warn about both types of dangerous accesses, and will
issue different warnings for the two.

Typically, programmers do not need to write annotations to use the
Index Checker. The Index Checker will infer properties of indexes from
the code around them (e.g.  it will infer that x is positive if we are
inside the then block of an ``if (x > 0)'' statement).

Internally, the Index Checker is composed of two checkers: the Lower
Bound Checker, which checks whether potential accesses may be too low,
and the Upper Bound Checker, which checks whether potential accesses
may be too high. The two checkers and their type hierarchies are
detailed in the remainder of this section.

\section{Running the Index Checker\label{index-running}}

To run the Index Checker, run the command

\begin{Verbatim}
javac -processor index MyJavaFile.java
\end{Verbatim}


\section{The Lower Bound Checker\label{index-lowerbound}}

The Lower Bound checker looks for accesses into arrays that might be
too low.  It warns its users about any such possible accesses. The
Lower Bound checker's type system is linear and fairly
straightforward. It primarily keeps track of each integer's relation
to zero, using the following qualifiers (all of which are inferred
automatically):

\begin{description}
\item[\refqualclass{checker/lowerbound/qual}{Positive}]
  This variable has value 1 or greater.
  Variables of this type are safe for use as array indices.
\item[\refqualclass{checker/lowerbound/qual}{NonNegative}]
  This variable has value 0 or greater.
  Variables of this type are safe for use as array indices.
\item[\refqualclass{checker/lowerbound/qual}{GreaterThanOrEqualToNegativeOne}]
  This variable has value -1 or greater.
  Variables of this type are unsafe for use as array indices.
\item[\refqualclass{checker/lowerbound/qual}{LowerBoundUnknown}]
  There is no information about the value of this variable.
  This type is the top type.
\end{description}

\begin{figure}
\includeimage{lowerbound}{7cm}
\caption{The type hierarchy used by the Lower Bound Checker.}
\label{fig-lowerbound-types}
\end{figure}

Users rarely have to write these annotations.  They are inferred on
constants, and at each program operation, the Lower Bound
Checker uses the rules of arithmetic to determine the type for the result.
The full list of rules appears in file \<lowerbound\_rules.txt> in the
source code's \<lowerbound/> directory.

\section{The Upper Bound Checker\label{index-upperbound}}

The Upper Bound Checker warns about array accesses whose index might be
too high. The Upper Bound Checker uses the following
qualifiers:

\begin{description}
\item[\refqualclasswithparams{checker/upperbound/qual}{LessThanLength}{String[] names}]
  A variable with this type
  has value less than the length of each array listed in names.
\item[\refqualclasswithparams{checker/upperbound/qual}{EqualToLength}{String[] names}]
  A variable with this type
  has value equal to the length of each array listed in names.
\item[\refqualclasswithparams{checker/upperbound/qual}{LessThanOrEqualToLength}{String[] names}]
  A variable with this type
  has value less than or equal to the length of each array listed in names.
\item[\refqualclass{checker/upperbound/qual}{UpperBoundUnknown}]
  There is no information about the value of this variable.
  This type is the top type.
\end{description}
